generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Applicant {
  id                   String    @id @default(uuid())
  createdAt            DateTime  @default(now())
  updatedAt            DateTime  @updatedAt
  email                String    @unique
  login                String    @unique
  contact              String
  firstName            String
  middleName           String?
  lastName             String
  phone                String?   @unique
  birthDate            DateTime?
  gender               Gender?
  city                 String?
  country              String?
  aboutMe              String?
  specialty            String?
  nickname             String?   @unique
  isReadyToRelocate    Boolean?
  isVisibleToEmployers Boolean   @default(true)
  isConfirmedByManager Boolean   @default(false)
  isEmailConfirmed     Boolean   @default(false)
  resume               Resume?
  meetings             Meeting[]
  assignedVacancies    Vacancy[] @relation("ApplicantToVacancy")
  offers               Offer[]
  hhToken              HhToken?
  password             Password?
}

model Employer {
  id                   String             @id @default(uuid())
  createdAt            DateTime           @default(now())
  updatedAt            DateTime           @updatedAt
  email                String             @unique
  login                String             @unique
  contact              String
  firstName            String
  middleName           String?
  lastName             String
  phone                String?            @unique
  name                 String?
  inn                  String?
  ogrn                 String?
  legalForm            EmployerLegalForm?
  agreementNumber      String?
  agreementDate        DateTime?
  isConfirmedByManager Boolean            @default(false)
  city                 String?
  isStartup            Boolean            @default(false)
  size                 EmployerSize?
  website              String?
  description          String?
  meetings             Meeting[]
  vacancies            Vacancy[]
  password             Password?
}

model Manager {
  id           String                @id @default(uuid())
  createdAt    DateTime              @default(now())
  updatedAt    DateTime              @updatedAt
  login        String                @unique
  name         String
  accessScopes ManagerAccessScopes[]
  slots        MeetingSlot[]
  password     Password?
}

model Password {
  id   String @id @default(uuid())
  hash String

  applicant   Applicant? @relation(fields: [applicantId], references: [id], onDelete: Cascade)
  applicantId String?    @unique

  employer   Employer? @relation(fields: [employerId], references: [id], onDelete: Cascade)
  employerId String?   @unique

  manager   Manager? @relation(fields: [managerId], references: [id], onDelete: Cascade)
  managerId String?  @unique
}

model HhToken {
  createdAt DateTime @default(now())

  applicant   Applicant @relation(fields: [applicantId], references: [id], onDelete: Cascade)
  applicantId String    @unique

  hhApplicantId String
  accessToken   String
  refreshToken  String
  expiresIn     Int
}

model EmailVerification {
  code      String   @id
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  userId    String   @unique
  role      String
}

model PasswordResetReqeust {
  code      String   @id @default(uuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  email     String   @unique
  role      String
}

model Vacancy {
  id                       String                @id @default(uuid())
  createdAt                DateTime              @default(now())
  updatedAt                DateTime              @updatedAt
  name                     String
  teamRole                 VacancyTeamRole
  description              String
  shortDescription         String?
  uniqueViewerApplicantIds String[]
  salary                   Int
  salaryCurrency           Currency
  experience               VacancyExperience
  employmentType           VacancyEmploymentType
  price                    Int?
  city                     String
  reportingForm            VacancyReportingForm
  workingHours             VacancyWorkingHours
  workplaceModel           VacancyWorkplaceModel
  isConfirmedByManager     Boolean               @default(false)
  keySkills                String[]
  candidates               Applicant[]           @relation("ApplicantToVacancy")
  offers                   Offer[]
  employer                 Employer              @relation(fields: [employerId], references: [id], onDelete: Cascade)
  employerId               String
}

model Offer {
  id             String      @id @default(uuid())
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt
  message        String
  salary         Int
  salaryCurrency Currency
  status         OfferStatus @default(PENDING)

  vacancyId String
  vacancy   Vacancy @relation(fields: [vacancyId], references: [id], onDelete: Cascade)

  candidateId String
  candidate   Applicant @relation(fields: [candidateId], references: [id], onDelete: Cascade)
}

model Resume {
  id                    String                       @id @default(uuid())
  createdAt             DateTime                     @default(now())
  importedFrom          ResumeImportExternalService?
  importedId            String?
  title                 String
  summary               String?
  city                  String?
  skills                String[]
  isVisibleToEmployers  Boolean                      @default(true)
  desiredSalary         Int?
  desiredSalaryCurrency Currency?
  certificates          ResumeCertificate[]
  contacts              ResumeContact[]
  education             ResumeEducation[]
  experience            ResumeExperience[]
  languages             ResumeLanguage[]
  applicant             Applicant                    @relation(fields: [applicantId], references: [id], onDelete: Cascade)
  applicantId           String                       @unique
}

model ResumeCertificate {
  id          String  @id @default(uuid())
  name        String
  description String?
  year        Int?
  resume      Resume  @relation(fields: [resumeId], references: [id], onDelete: Cascade)
  resumeId    String
}

model ResumeContact {
  id        String      @id @default(uuid())
  name      String?
  type      ContactType
  value     String
  preferred Boolean     @default(false)
  resume    Resume      @relation(fields: [resumeId], references: [id], onDelete: Cascade)
  resumeId  String
}

model ResumeEducation {
  id          String  @id @default(uuid())
  name        String
  description String?
  degree      String?
  startYear   Int?
  endYear     Int
  resume      Resume  @relation(fields: [resumeId], references: [id], onDelete: Cascade)
  resumeId    String
}

model ResumeExperience {
  id          String  @id @default(uuid())
  company     String?
  position    String
  startMonth  Int
  startYear   Int
  endMonth    Int?
  endYear     Int?
  description String?
  resume      Resume  @relation(fields: [resumeId], references: [id], onDelete: Cascade)
  resumeId    String
}

model ResumeLanguage {
  id       String        @id @default(uuid())
  name     String
  level    LanguageLevel
  resume   Resume        @relation(fields: [resumeId], references: [id], onDelete: Cascade)
  resumeId String
}

model Meeting {
  id              String                  @id @default(uuid())
  createdAt       DateTime                @default(now())
  updatedAt       DateTime                @updatedAt
  name            String
  description     String
  roomUrl         String
  type            MeetingType
  status          MeetingStatus           @default(PLANNED)
  feedback        MeetingFeedback[]
  scriptProtocols MeetingScriptProtocol[]
  slot            MeetingSlot             @relation(fields: [slotId], references: [id])
  slotId          String                  @unique
  applicant       Applicant?              @relation(fields: [applicantId], references: [id], onDelete: Cascade)
  applicantId     String?
  employer        Employer?               @relation(fields: [employerId], references: [id], onDelete: Cascade)
  employerId      String?
}

model MeetingSlot {
  id        String        @id @default(uuid())
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt
  dateTime  DateTime
  types     MeetingType[]
  meeting   Meeting?
  manager   Manager       @relation(fields: [managerId], references: [id])
  managerId String
}

model MeetingScriptProtocol {
  id         String                @id @default(uuid())
  createdAt  DateTime              @default(now())
  updatedAt  DateTime              @updatedAt
  answers    MeetingScriptAnswer[]
  meeting    Meeting               @relation(fields: [meetingId], references: [id], onDelete: Cascade)
  meetingId  String
  template   MeetingScriptTemplate @relation(fields: [templateId], references: [id])
  templateId String
}

model MeetingScriptTemplate {
  id          String                  @id @default(uuid())
  createdAt   DateTime                @default(now())
  updatedAt   DateTime                @updatedAt
  title       String
  description String?
  protocols   MeetingScriptProtocol[]
  questions   MeetingScriptQuestion[] @relation("MeetingScriptQuestionToMeetingScriptTemplate")
}

model MeetingScriptQuestion {
  id            String                  @id @default(uuid())
  createdAt     DateTime                @default(now())
  updatedAt     DateTime                @updatedAt
  text          String
  answerOptions String[]
  answers       MeetingScriptAnswer[]
  templates     MeetingScriptTemplate[] @relation("MeetingScriptQuestionToMeetingScriptTemplate")
}

model MeetingScriptAnswer {
  id         String                @id @default(uuid())
  createdAt  DateTime              @default(now())
  updatedAt  DateTime              @updatedAt
  text       String
  protocol   MeetingScriptProtocol @relation(fields: [protocolId], references: [id], onDelete: Cascade)
  protocolId String
  question   MeetingScriptQuestion @relation(fields: [questionId], references: [id])
  questionId String
}

model MeetingFeedback {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  name      String
  text      String
  meeting   Meeting  @relation(fields: [meetingId], references: [id], onDelete: Cascade)
  meetingId String
}

model PartnershipInquiry {
  id                 String                   @id @default(uuid())
  createdAt          DateTime                 @default(now())
  updatedAt          DateTime                 @updatedAt
  representativeName String
  companyName        String
  contact            String
  email              String
  status             PartnershipInquiryStatus @default(PENDING)
}

model SoftArchive {
  id         String   @id @default(uuid())
  createdAt  DateTime @default(now())
  originalId String
  modelName  String
  payload    Json
}

model University {
  id        Int     @id @default(autoincrement())
  name      String  @unique
  shortName String?
  logoUrl   String?
}

enum ContactType {
  PHONE
  EMAIL
  TELEGRAM
  VK
  FACEBOOK
  LINKEDIN
  GITHUB
  OTHER
}

enum LanguageLevel {
  A1
  A2
  B1
  B2
  C1
  C2
  L1
}

enum ResumeImportExternalService {
  HH
}

enum Currency {
  RUB
  USD
  EUR
  GBP
  GEL
  AZN
  BYR
  KGS
  KZT
  UZS
  UAH
}

enum EmployerLegalForm {
  INDIVIDUAL_ENTREPRENEUR
  OOO
  ZAO
  PAO
  NKO
}

enum EmployerSize {
  LESS_THAN_15
  BETWEEN_15_AND_50
  BETWEEN_50_AND_100
  BETWEEN_100_AND_500
  MORE_THAN_500
}

enum VacancyExperience {
  NO_EXPERIENCE
  BETWEEN_1_AND_3
  BETWEEN_3_AND_6
  MORE_THAN_6
}

enum VacancyEmploymentType {
  FULL_TIME
  PART_TIME
  PROJECT
  VOLUNTEER
  PROBATION
}

enum VacancyReportingForm {
  DIRECTOR
  PROJECT_MANAGER
  GROUP_WORK
  INDEPENDENT_WORK
}

enum VacancyTeamRole {
  COLLABORATIVE_WORK
  TEAM_COORDINATION
  TEAM_MANAGEMENT
  INDEPENDENT_WORK
}

enum VacancyWorkingHours {
  STRICT_SCHEDULE
  FREELANCE
  GROUP_WORK
  FIXED_HOURS
}

enum VacancyWorkplaceModel {
  OFFICE
  HYBRID
  REMOTE
}

enum VacancyStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum OfferStatus {
  PENDING
  ACCEPTED
  DECLINED
}

enum PartnershipInquiryStatus {
  PENDING
  RESOLVED
}

enum MeetingType {
  INTERVIEW
  CONSULTATION_B2C
  CONSULTATION_B2B
}

enum MeetingStatus {
  PLANNED
  CANCELED
  COMPLETED
}

enum Gender {
  MALE
  FEMALE
}

enum ManagerAccessScopes {
  NONE
}
